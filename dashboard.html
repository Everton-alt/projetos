<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Painel de Controle</h1>
            <div class="user-info">
                <span id="welcomeMessage"></span> |
                <span>Área de Registro</span> |
                <a href="register.html" style="color: white;">Gerenciar Usuários</a> |
                <a href="address.html" style="color: white;">Cadastrar Endereço</a> |
                <a href="#" onclick="auth.logout()" style="color: white;">Sair</a>
            </div>
        </div>
        
        <div id="entry-form" class="card">
            <h2>Novo Recebimento</h2>
            <div id="form-message" class="alert" style="display:none;"></div>
            <div class="form-group">
                <label for="receiptDate">Data de Recebimento</label>
                <input type="date" id="receiptDate">
            </div>
            <div class="form-group">
                <label for="listNumber">Nº da Lista</label>
                <input type="text" id="listNumber" placeholder="Ex: 001">
            </div>
            <div class="form-group">
                <label for="receivedBy">Recebido por</label>
                <input type="text" id="receivedBy" readonly>
            </div>
            <div class="form-group">
                <label for="location">Local</label>
                <input type="text" id="location" placeholder="Ex: Galpão B, Corredor 3">
            </div>
            <div class="form-group">
                <label for="obs">Observações</label>
                <textarea id="obs" placeholder="Ex: Mercadoria com avaria."></textarea>
            </div>
            <div class="form-group">
                <label for="photo">Foto do Recebimento</label>
                <input type="file" id="photo" accept="image/*" capture="camera">
            </div>
            <button class="btn btn-primary" onclick="addEntry()">Registrar Recebimento</button>
        </div>
        
        <div class="dashboard-grid">
            <div id="total" class="card">
                <h3>Total de Recebimentos</h3>
                <p id="totalCount">0</p>
            </div>
            <div class="card">
                <button class="btn btn-primary" style="width: 100%;" onclick="window.location.href='data.html'">Ver Planilha</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            render.dashboard();
            dashboard.updateStats();
        });

        const dashboard = {
            updateStats: () => {
                const data = dataManager.load();
                const total = data.length;
                document.getElementById('totalCount').textContent = total;
            }
        };

        const addEntry = () => {
            const receiptDate = document.getElementById('receiptDate').value;
            const listNumber = document.getElementById('listNumber').value;
            const receivedBy = document.getElementById('receivedBy').value;
            const location = document.getElementById('location').value;
            const obs = document.getElementById('obs').value;
            const photoFile = document.getElementById('photo').files[0];
            const msgEl = document.getElementById('form-message');

            if (!receiptDate || !listNumber || !receivedBy) {
                msgEl.className = 'alert alert-error';
                msgEl.textContent = 'Por favor, preencha todos os campos obrigatórios: Data, Nº da Lista e Recebido por.';
                msgEl.style.display = 'block';
                return;
            }

            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const newEntry = {
                        receiptDate,
                        listNumber,
                        receivedBy,
                        location,
                        obs,
                        photo: event.target.result // Salva a foto como Data URL
                    };
                    dataManager.addEntry(newEntry);
                    showSuccessMessage();
                };
                reader.readAsDataURL(photoFile);
            } else {
                const newEntry = {
                    receiptDate,
                    listNumber,
                    receivedBy,
                    location,
                    obs,
                    photo: null
                };
                dataManager.addEntry(newEntry);
                showSuccessMessage();
            }
        };

        const showSuccessMessage = () => {
            const msgEl = document.getElementById('form-message');
            msgEl.className = 'alert alert-success';
            msgEl.textContent = 'Novo recebimento registrado com sucesso!';
            msgEl.style.display = 'block';

            // Limpa os campos após o registro, exceto o de recebido por
            document.getElementById('receiptDate').value = getTodayDate();
            document.getElementById('listNumber').value = '';
            document.getElementById('location').value = '';
            document.getElementById('obs').value = '';
            document.getElementById('photo').value = ''; // Limpa o campo de foto

            dashboard.updateStats();
        };
    </script>
</body>
</html>
